# Results

Here, we analyze each variable one by one to see how the crime rate changes under different categories.


```{r}
#data=read.csv("D:/Desktop/GR5702/Final/NYPD_Complaint_Data_Historic.csv")
#data=read.csv("~/Desktop/NYPD_Complaint_Data_Historic.csv")
data=read.csv("~/NYPD_Complaint_Data_Historic.csv")
```

```{r}
# package
library(ggalluvial)
library(ggplot2)
library(tidyverse)
library(gridExtra)
library(vcd)
library(grid)
library(parcoords)
library(plotly)
library(dplyr)
```

## Variables

### RPT_DT

Variable "RPT_DT" is the date that the event was reported to police.

From the Time Series plot, we found that the year-to-year crime trends were similar, with lower numbers at the beginning and end of the year and higher numbers in the middle of the year. 

```{r}
t6<-as.data.frame(table(data$RPT_DT))
t6$Var1<-as.Date(t6$Var1,"%m/%d/%Y")
ggplot(t6, aes(x=Var1, y=Freq)) +
  geom_line()
```

Therefore, we break down the number of crimes by month. Crimes are higher from May to October and highest in July, lowest in February.

```{r}
data$month<-str_sub(data$RPT_DT,1,2)
barplot(table(data$month))
```

### OFNS_DESC

Variable "OFNS_DESC" is the crime description of corresponding to the offense event. 

As we can see from the Cleveland dot plot below, in the New York area, the most committed crime was "Petit Larceny". Appeared more than 200,000 times from 2017 to 2019. Besides, the crimes of harrassment also exceed 200,000 times and crimes of assault & related offenses, criminal mischief, grand larceny exceed 100,000 times. These were the types of crimes that occurred the most during the three-year period. They are sudden crimes and mainly threaten personal financial security.

```{r}
data$year<-str_sub(data$RPT_DT,7,10)
a<-as.data.frame(table(data$OFNS_DESC,data$year))
colnames(a)<-c("offense","year","Freq")
temp<-subset(a,a$Freq>100)

ggplot(temp,aes(x=Freq,y=fct_reorder2(offense,year=="2019",Freq,.desc=FALSE)))+
  geom_point(aes(color=year))+
  ggtitle("crimes in offense category") +
  xlab("counts") +
  ylab("")
```

### LAW_CAT_CD, BORO_NM

Variable "LAW_CAT_CD" is the level of offense, it contains felony, misdemeanor and violation. Variable "BORO_NM" is the name of the borough in which the incident occurred.

As we can see from the Horizontal Stacked Bar chart, Brooklyn has the most crimes and Staten Island has the least. This may be caused by the population gap, but still reminds us of the security situation in different regions. At the same time, from the perspective of crime level, most crimes are misdemeanors, and the number of serious crimes is second. But in terms of seriousness, felony causes greater personal harm and social impact, so we need to pay more attention to its data. In terms of numbers, the Brooklyn area had the highest number of felony crimes. But in terms of proportion, the proportion of felony crimes in each region is near 20%. 


```{r}
t1<-as.data.frame(table(data$BORO_NM,data$LAW_CAT_CD))
t1<-t1[t1$Var1!="",]
ggplot(t1, aes(x = Freq ,y=reorder(Var1,Freq),fill=Var2)) + 
  geom_bar(stat='identity')+
  ylab("crime counts")+
  xlab("Borough")
```

### PREM_TYP_DESC

Variable "PREM_TYP_DESC" is specific description of where the crime occurred, e.g. grocery store, home, street, etc.

The most crimes occurred on the street, followed by residential apartment house, with more than 100,000 crimes during three years. Crimes occurred in each year is similar, there is no sudden decrease or sudden increase.


```{r}
data$year<-str_sub(data$RPT_DT,7,10)
b<-table(data$PREM_TYP_DESC,data$year)
c<-as.data.frame.array(b)
c<-data.frame(premise=row.names(b),c)

colnames(c)<-c("premise","2017","2018","2019")
c$total<-c$`2017`+c$`2018`+c$`2019`

d<-subset(c,c$total>5000)
data.frame(d)  %>%
  parcoords(  
    rownames = F   
    , brushMode = "1D-axes"  
    , reorderable = T
    , queue = T  
    , color = list(  
      colorBy = "premise"  
      ,colorScale = "scaleOrdinal"  
      ,colorScheme = "schemeCategory10"  
    )  
    , withD3 = TRUE  
  )
```

### Latitude and Longitude
This part contains two variables "Latitude" and "Longitude".

As we can see from the histogram of crime frequency count corresponding to latitude and longitude, there are multi peaks in both graphs. This might indicate that there are some regions with more crimes happened. For example, there is a peak around 40.755 on latitude and a peak around -73.99 on longitude. Locating (40.755, -73.99) is somewhere near time square. The data might suggest that there are more crime happend near around this region.
```{r}
p1 <- ggplot(data, aes(x=Latitude))+
  geom_histogram(binwidth=0.005)
p2 <- ggplot(data, aes(x=Longitude))+
  geom_histogram(binwidth=0.005)
ggplotly(p1)
ggplotly(p2)
```

From the scatter plot and 2D histogram, we can see that Manhattan and Bronx has densest crime happened, then is Brooklyn, Queens, and  last Staten Island. The crimes happened in central park is rare according to both graphs, suggesting that it might be a safe place on Manhattan. The 2d histogram again confirm our previous guess that there are many crimes happened near time square. 

```{r}
ggplot(data, aes(x=Longitude, y=Latitude, color=BORO_NM))+
  geom_point(size=0.005, alpha=0.0075)
```

```{r}
ggplot(data, aes(x=Longitude, y=Latitude))+
  geom_bin2d(binwidth=c(0.005, 0.005))+
  scale_fill_distiller(palette="YlOrRd", direction=1)
```

### Age_group

This part contains two variables "SUSP_AGE_GROUP" and "VIC_AGE_GROUP". These records the ages of suspects and victims of offense, helping us better understand the characteristics of suspects and helping us identify potential threats.

Ignoring the group of unknown, we see that both suspects and victims are concentrated between 25-44 years old. The numbers of both suspects and victims gradually decrease as age decreases before 25 years old or increases after 44 years old.

```{r}
data1<-data[,c(24:26,33:35)]
data1$SUSP_AGE_GROUP[data1$SUSP_AGE_GROUP==""]<- NA #why set empty to NA. Is there differen between "" and unknown?
data1$SUSP_RACE[data1$SUSP_RACE==""]<- NA
data1$SUSP_SEX[data1$SUSP_SEX==""]<- NA

data1$VIC_AGE_GROUP[data1$VIC_AGE_GROUP==""]<- NA
data1$VIC_RACE[data1$VIC_RACE==""]<- NA
data1$VIC_SEX[data1$VIC_SEX==""]<- NA

data1$SUSP_AGE_GROUP<-ifelse(data1$SUSP_AGE_GROUP=="<18","<18",
                             ifelse(data1$SUSP_AGE_GROUP=="18-24","18-24",
                                    ifelse(data1$SUSP_AGE_GROUP=="25-44","25-44",
                                           ifelse(data1$SUSP_AGE_GROUP=="45-64","45-64",
                                                  ifelse(data1$SUSP_AGE_GROUP=="65+","65+","Unknown")))
))


data1$VIC_AGE_GROUP<-ifelse(data1$VIC_AGE_GROUP=="<18","<18",
                             ifelse(data1$VIC_AGE_GROUP=="18-24","18-24",
                                    ifelse(data1$VIC_AGE_GROUP=="25-44","25-44",
                                           ifelse(data1$VIC_AGE_GROUP=="45-64","45-64",
                                                  ifelse(data1$VIC_AGE_GROUP=="65+","65+","Unknown")))
                             ))
```

```{r}
t2<-as.data.frame(table(data1$SUSP_AGE_GROUP))
t3<-as.data.frame(table(data1$VIC_AGE_GROUP))
t2_t3<-merge(t2,t3,by="Var1")
colnames(t2_t3)<-c("age","susp",'vic')
tidyt<-t2_t3%>%pivot_longer(cols=!age,names_to = "type",values_to = "count")
ggplot(tidyt, aes(x = age, y = count)) +
  geom_bar(
    aes(color = type, fill = type),
    stat = "identity", position = position_dodge(0.8),
    width = 0.7
  )+
  facet_wrap(~type)
```

```{r}
data1_age_freq <- data1 %>% group_by(SUSP_AGE_GROUP, VIC_AGE_GROUP) %>% summarize(Freq = n())%>% ungroup() %>% filter(!is.na(SUSP_AGE_GROUP) && !is.na(VIC_AGE_GROUP)) %>% filter(SUSP_AGE_GROUP!="Unknown") %>% filter(VIC_AGE_GROUP!="Unknown")
```

From the alluvial graph, we see that crimes more likely to happen between peers from same age group. The percentage of crime decreases as age difference enlarges. One thing we notice is that for suspects aging below 18, the percentage of victim aging between 18 and 24 is less than 25-44 age range and even less than 45-64 age range.

```{r}
ggplot(data1_age_freq, aes(axis1=SUSP_AGE_GROUP, axis2=VIC_AGE_GROUP, y=Freq))+
  geom_flow(aes(fill=SUSP_AGE_GROUP))+
  geom_stratum()+
  geom_text(stat="stratum", aes(label=paste(after_stat(stratum), "\n", after_stat(count))), size=2)+
  scale_x_discrete(limits=c("susp_age_group", "vic_age_group"))
```

### Race

This part also contains two variables "SUSP_RACE" and "VIC_RACE". These records the race of suspects and victims of offense.

Sorted by suspect's race, ignoring UNKNOWN group, We found that the race with the more suspects, the more victims. Blacks have the most suspects and victims, which reminds us that the living environment of blacks in New York may be worse than other races.


```{r}
t4<-as.data.frame(table(data1$SUSP_RACE))
t5<-as.data.frame(table(data1$VIC_RACE))
t4_t5<-merge(t4,t5,by="Var1")
colnames(t4_t5)<-c("race","susp",'vic')
tidyt<-t4_t5%>%pivot_longer(cols=!race,names_to = "type",values_to = "count")

library(forcats)
ggplot(tidyt,aes(x=count,y=fct_reorder2(race,type=="susp",count,.desc=FALSE)))+
  geom_point(aes(color=type),size=3)
```

From the alluvial graph, we see that crimes more likely to happen between peers from same race. From both graphs, we see that blacks and black hispanic has more suspects than victims. For victims from almost all races, the largest proportion of corresponding suspect comes from same race, the second largest proportion of corresponding suspect comes from Blacks(except for AMERICAN INDIAN/ALASKAN NATIVE where the race of most suspect is Black and second largest is same, and Black where the second largest is White Hispanic). 
```{r}
data1_race_freq <- data1 %>% group_by(SUSP_RACE, VIC_RACE) %>% summarize(Freq = n())%>% ungroup()%>% filter(!is.na(SUSP_RACE) && !is.na(VIC_RACE)) %>% filter(SUSP_RACE!="UNKNOWN") %>% filter(VIC_RACE!="UNKNOWN")
```
```{r}
ggplot(data1_race_freq, aes(axis1=SUSP_RACE, axis2=VIC_RACE, y=Freq))+
  geom_flow(aes(fill=VIC_RACE))+
  geom_stratum()+
  geom_text(stat="stratum", aes(label=paste(after_stat(stratum), "\n", after_stat(count))), size=2)+
  scale_x_discrete(limits=c("susp_race", "vic_race"))
```

## Relationships

### SUSP_SEX & law_cat_cd

This mosaic plot showed us the relationship between suspect's sex and the level of offenses. Among all crimes, male suspects accounted for the highest proportion. Female suspects take a relatively large proportion of the level of violation, and the proportion of female suspects gradually decreasing as the severity of the offenses increases.

```{r}
data1$law_cat_cd=data$LAW_CAT_CD
mosaic(SUSP_SEX~law_cat_cd,data1,direction = c("v", "h"))

data1$law_cat_cd=data$LAW_CAT_CD
mosaic(VIC_SEX~law_cat_cd,data1,direction = c("v", "h"))
```

```{r}
data1_sex_freq <- data1 %>% group_by(SUSP_SEX, VIC_SEX) %>% summarize(Freq = n())%>% ungroup()%>% filter(!is.na(SUSP_SEX) && !is.na(VIC_SEX)) %>% filter(SUSP_SEX!="UNKNOWN") %>% filter(VIC_SEX!="UNKNOWN")
ggplot(data1_sex_freq, aes(axis1=SUSP_SEX, axis2=VIC_SEX, y=Freq))+
  geom_flow(aes(fill=VIC_SEX))+
  geom_stratum()+
  geom_text(stat="stratum", aes(label=paste(after_stat(stratum), "\n", after_stat(count))), size=2)+
  scale_x_discrete(limits=c("susp_sex", "vic_sex"))
```

From the mosaic plot and alluvial plot, we can see that female victims involve in a crime having a male suspect, and male suspect choose female victim as top target.


